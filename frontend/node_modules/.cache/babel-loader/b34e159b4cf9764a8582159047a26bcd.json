{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { CRUD_GET_MANY_REFERENCE_SUCCESS } from '../../../actions';\nimport { DELETE, DELETE_MANY } from '../../../core';\nvar initialState = {};\n\nvar oneToManyReducer = function (previousState, action) {\n  var _a;\n\n  if (previousState === void 0) {\n    previousState = initialState;\n  }\n\n  if (action.meta && action.meta.optimistic) {\n    var relatedTo = getRelatedReferences(previousState, action.meta.resource);\n\n    if (action.meta.fetch === DELETE) {\n      return relatedTo.reduce(removeDeletedReferences([action.payload.id]), previousState);\n    }\n\n    if (action.meta.fetch === DELETE_MANY) {\n      return relatedTo.reduce(removeDeletedReferences(action.payload.ids), previousState);\n    }\n  }\n\n  switch (action.type) {\n    case CRUD_GET_MANY_REFERENCE_SUCCESS:\n      return __assign(__assign({}, previousState), (_a = {}, _a[action.meta.relatedTo] = {\n        ids: action.payload.data.map(function (record) {\n          return record.id;\n        }),\n        total: action.payload.total\n      }, _a));\n\n    default:\n      return previousState;\n  }\n};\n\nexport var getIds = function (state, relatedTo) {\n  return state.admin.references.oneToMany[relatedTo] && state.admin.references.oneToMany[relatedTo].ids;\n};\nexport var getTotal = function (state, relatedTo) {\n  return state.admin.references.oneToMany[relatedTo] && state.admin.references.oneToMany[relatedTo].total;\n};\nexport var getReferences = function (state, reference, relatedTo) {\n  var ids = getIds(state, relatedTo);\n\n  if (typeof ids === 'undefined') {\n    return undefined;\n  }\n\n  if (!state.admin.resources[reference]) {\n    // eslint-disable-next-line no-console\n    console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" + (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") + 'but it has not been declared.\\n' + \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField and ReferenceManyField.\", {\n      ids: ids\n    });\n  }\n\n  return ids.map(function (id) {\n    var resource = state.admin.resources[reference];\n\n    if (!resource) {\n      return undefined;\n    }\n\n    return resource.data[id];\n  }).filter(function (r) {\n    return typeof r !== 'undefined';\n  }).reduce(function (prev, record) {\n    prev[record.id] = record; // eslint-disable-line no-param-reassign\n\n    return prev;\n  }, {});\n};\nexport var getReferencesByIds = function (state, reference, ids) {\n  if (ids.length === 0) {\n    return {};\n  }\n\n  if (!state.admin.resources[reference]) {\n    // eslint-disable-next-line no-console\n    console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" + (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") + 'but it has not been declared.\\n' + \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField.\", {\n      ids: ids\n    });\n  }\n\n  var references = ids.map(function (id) {\n    var resource = state.admin.resources[reference];\n\n    if (!resource) {\n      return undefined;\n    }\n\n    return resource.data[id];\n  }).filter(function (r) {\n    return typeof r !== 'undefined';\n  }).reduce(function (prev, record) {\n    prev[record.id] = record; // eslint-disable-line no-param-reassign\n\n    return prev;\n  }, {});\n  return Object.keys(references).length > 0 ? references : null;\n};\n\nvar getRelatedReferences = function (previousState, resource) {\n  return Object.keys(previousState).filter(function (key) {\n    return key.includes(resource);\n  });\n};\n\nvar removeDeletedReferences = function (removedIds) {\n  return function (previousState, key) {\n    var _a;\n\n    var idsToKeep = previousState[key].ids.filter(function (id) {\n      return !removedIds.includes(id);\n    });\n\n    if (idsToKeep.length === previousState[key].ids.length) {\n      return previousState;\n    }\n\n    return __assign(__assign({}, previousState), (_a = {}, _a[key] = {\n      ids: idsToKeep,\n      total: idsToKeep.length\n    }, _a));\n  };\n};\n\nexport var nameRelatedTo = function (reference, id, resource, target, filter) {\n  if (filter === void 0) {\n    filter = {};\n  }\n\n  var keys = Object.keys(filter);\n\n  if (!keys.length) {\n    return resource + \"_\" + reference + \"@\" + target + \"_\" + id;\n  }\n\n  return resource + \"_\" + reference + \"@\" + target + \"_\" + id + \"?\" + keys.map(function (key) {\n    return key + \"=\" + JSON.stringify(filter[key]);\n  }).join('&');\n};\nexport default oneToManyReducer;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","CRUD_GET_MANY_REFERENCE_SUCCESS","DELETE","DELETE_MANY","initialState","oneToManyReducer","previousState","action","_a","meta","optimistic","relatedTo","getRelatedReferences","resource","fetch","reduce","removeDeletedReferences","payload","id","ids","type","data","map","record","total","getIds","state","admin","references","oneToMany","getTotal","getReferences","reference","undefined","resources","console","error","filter","r","prev","getReferencesByIds","keys","key","includes","removedIds","idsToKeep","nameRelatedTo","target","JSON","stringify","join"],"sources":["/app/node_modules/ra-core/esm/reducer/admin/references/oneToMany.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { CRUD_GET_MANY_REFERENCE_SUCCESS, } from '../../../actions';\nimport { DELETE, DELETE_MANY } from '../../../core';\nvar initialState = {};\nvar oneToManyReducer = function (previousState, action) {\n    var _a;\n    if (previousState === void 0) { previousState = initialState; }\n    if (action.meta && action.meta.optimistic) {\n        var relatedTo = getRelatedReferences(previousState, action.meta.resource);\n        if (action.meta.fetch === DELETE) {\n            return relatedTo.reduce(removeDeletedReferences([action.payload.id]), previousState);\n        }\n        if (action.meta.fetch === DELETE_MANY) {\n            return relatedTo.reduce(removeDeletedReferences(action.payload.ids), previousState);\n        }\n    }\n    switch (action.type) {\n        case CRUD_GET_MANY_REFERENCE_SUCCESS:\n            return __assign(__assign({}, previousState), (_a = {}, _a[action.meta.relatedTo] = {\n                ids: action.payload.data.map(function (record) { return record.id; }),\n                total: action.payload.total,\n            }, _a));\n        default:\n            return previousState;\n    }\n};\nexport var getIds = function (state, relatedTo) {\n    return state.admin.references.oneToMany[relatedTo] &&\n        state.admin.references.oneToMany[relatedTo].ids;\n};\nexport var getTotal = function (state, relatedTo) {\n    return state.admin.references.oneToMany[relatedTo] &&\n        state.admin.references.oneToMany[relatedTo].total;\n};\nexport var getReferences = function (state, reference, relatedTo) {\n    var ids = getIds(state, relatedTo);\n    if (typeof ids === 'undefined') {\n        return undefined;\n    }\n    if (!state.admin.resources[reference]) {\n        // eslint-disable-next-line no-console\n        console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" +\n            (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") +\n            'but it has not been declared.\\n' +\n            \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField and ReferenceManyField.\", { ids: ids });\n    }\n    return ids\n        .map(function (id) {\n        var resource = state.admin.resources[reference];\n        if (!resource) {\n            return undefined;\n        }\n        return resource.data[id];\n    })\n        .filter(function (r) { return typeof r !== 'undefined'; })\n        .reduce(function (prev, record) {\n        prev[record.id] = record; // eslint-disable-line no-param-reassign\n        return prev;\n    }, {});\n};\nexport var getReferencesByIds = function (state, reference, ids) {\n    if (ids.length === 0) {\n        return {};\n    }\n    if (!state.admin.resources[reference]) {\n        // eslint-disable-next-line no-console\n        console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" +\n            (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") +\n            'but it has not been declared.\\n' +\n            \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField.\", { ids: ids });\n    }\n    var references = ids\n        .map(function (id) {\n        var resource = state.admin.resources[reference];\n        if (!resource) {\n            return undefined;\n        }\n        return resource.data[id];\n    })\n        .filter(function (r) { return typeof r !== 'undefined'; })\n        .reduce(function (prev, record) {\n        prev[record.id] = record; // eslint-disable-line no-param-reassign\n        return prev;\n    }, {});\n    return Object.keys(references).length > 0 ? references : null;\n};\nvar getRelatedReferences = function (previousState, resource) { return Object.keys(previousState).filter(function (key) { return key.includes(resource); }); };\nvar removeDeletedReferences = function (removedIds) { return function (previousState, key) {\n    var _a;\n    var idsToKeep = previousState[key].ids.filter(function (id) { return !removedIds.includes(id); });\n    if (idsToKeep.length === previousState[key].ids.length) {\n        return previousState;\n    }\n    return __assign(__assign({}, previousState), (_a = {}, _a[key] = {\n        ids: idsToKeep,\n        total: idsToKeep.length,\n    }, _a));\n}; };\nexport var nameRelatedTo = function (reference, id, resource, target, filter) {\n    if (filter === void 0) { filter = {}; }\n    var keys = Object.keys(filter);\n    if (!keys.length) {\n        return resource + \"_\" + reference + \"@\" + target + \"_\" + id;\n    }\n    return resource + \"_\" + reference + \"@\" + target + \"_\" + id + \"?\" + keys\n        .map(function (key) { return key + \"=\" + JSON.stringify(filter[key]); })\n        .join('&');\n};\nexport default oneToManyReducer;\n"],"mappings":"AAAA,IAAIA,QAAQ,GAAI,QAAQ,KAAKA,QAAd,IAA2B,YAAY;EAClDA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAASC,CAAT,EAAY;IACpC,KAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;MACjDD,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;MACA,KAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;IACP;;IACD,OAAON,CAAP;EACH,CAPD;;EAQA,OAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CAVD;;AAWA,SAASO,+BAAT,QAAiD,kBAAjD;AACA,SAASC,MAAT,EAAiBC,WAAjB,QAAoC,eAApC;AACA,IAAIC,YAAY,GAAG,EAAnB;;AACA,IAAIC,gBAAgB,GAAG,UAAUC,aAAV,EAAyBC,MAAzB,EAAiC;EACpD,IAAIC,EAAJ;;EACA,IAAIF,aAAa,KAAK,KAAK,CAA3B,EAA8B;IAAEA,aAAa,GAAGF,YAAhB;EAA+B;;EAC/D,IAAIG,MAAM,CAACE,IAAP,IAAeF,MAAM,CAACE,IAAP,CAAYC,UAA/B,EAA2C;IACvC,IAAIC,SAAS,GAAGC,oBAAoB,CAACN,aAAD,EAAgBC,MAAM,CAACE,IAAP,CAAYI,QAA5B,CAApC;;IACA,IAAIN,MAAM,CAACE,IAAP,CAAYK,KAAZ,KAAsBZ,MAA1B,EAAkC;MAC9B,OAAOS,SAAS,CAACI,MAAV,CAAiBC,uBAAuB,CAAC,CAACT,MAAM,CAACU,OAAP,CAAeC,EAAhB,CAAD,CAAxC,EAA+DZ,aAA/D,CAAP;IACH;;IACD,IAAIC,MAAM,CAACE,IAAP,CAAYK,KAAZ,KAAsBX,WAA1B,EAAuC;MACnC,OAAOQ,SAAS,CAACI,MAAV,CAAiBC,uBAAuB,CAACT,MAAM,CAACU,OAAP,CAAeE,GAAhB,CAAxC,EAA8Db,aAA9D,CAAP;IACH;EACJ;;EACD,QAAQC,MAAM,CAACa,IAAf;IACI,KAAKnB,+BAAL;MACI,OAAOd,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKmB,aAAL,CAAT,GAA+BE,EAAE,GAAG,EAAL,EAASA,EAAE,CAACD,MAAM,CAACE,IAAP,CAAYE,SAAb,CAAF,GAA4B;QAC/EQ,GAAG,EAAEZ,MAAM,CAACU,OAAP,CAAeI,IAAf,CAAoBC,GAApB,CAAwB,UAAUC,MAAV,EAAkB;UAAE,OAAOA,MAAM,CAACL,EAAd;QAAmB,CAA/D,CAD0E;QAE/EM,KAAK,EAAEjB,MAAM,CAACU,OAAP,CAAeO;MAFyD,CAArC,EAG3ChB,EAHY,EAAf;;IAIJ;MACI,OAAOF,aAAP;EAPR;AASH,CArBD;;AAsBA,OAAO,IAAImB,MAAM,GAAG,UAAUC,KAAV,EAAiBf,SAAjB,EAA4B;EAC5C,OAAOe,KAAK,CAACC,KAAN,CAAYC,UAAZ,CAAuBC,SAAvB,CAAiClB,SAAjC,KACHe,KAAK,CAACC,KAAN,CAAYC,UAAZ,CAAuBC,SAAvB,CAAiClB,SAAjC,EAA4CQ,GADhD;AAEH,CAHM;AAIP,OAAO,IAAIW,QAAQ,GAAG,UAAUJ,KAAV,EAAiBf,SAAjB,EAA4B;EAC9C,OAAOe,KAAK,CAACC,KAAN,CAAYC,UAAZ,CAAuBC,SAAvB,CAAiClB,SAAjC,KACHe,KAAK,CAACC,KAAN,CAAYC,UAAZ,CAAuBC,SAAvB,CAAiClB,SAAjC,EAA4Ca,KADhD;AAEH,CAHM;AAIP,OAAO,IAAIO,aAAa,GAAG,UAAUL,KAAV,EAAiBM,SAAjB,EAA4BrB,SAA5B,EAAuC;EAC9D,IAAIQ,GAAG,GAAGM,MAAM,CAACC,KAAD,EAAQf,SAAR,CAAhB;;EACA,IAAI,OAAOQ,GAAP,KAAe,WAAnB,EAAgC;IAC5B,OAAOc,SAAP;EACH;;EACD,IAAI,CAACP,KAAK,CAACC,KAAN,CAAYO,SAAZ,CAAsBF,SAAtB,CAAL,EAAuC;IACnC;IACAG,OAAO,CAACC,KAAR,CAAc,wBAAwBJ,SAAxB,GAAoC,MAApC,IACT,sEAAsEA,SAAtE,GAAkF,MADzE,IAEV,iCAFU,GAGV,iHAHJ,EAGuH;MAAEb,GAAG,EAAEA;IAAP,CAHvH;EAIH;;EACD,OAAOA,GAAG,CACLG,GADE,CACE,UAAUJ,EAAV,EAAc;IACnB,IAAIL,QAAQ,GAAGa,KAAK,CAACC,KAAN,CAAYO,SAAZ,CAAsBF,SAAtB,CAAf;;IACA,IAAI,CAACnB,QAAL,EAAe;MACX,OAAOoB,SAAP;IACH;;IACD,OAAOpB,QAAQ,CAACQ,IAAT,CAAcH,EAAd,CAAP;EACH,CAPM,EAQFmB,MARE,CAQK,UAAUC,CAAV,EAAa;IAAE,OAAO,OAAOA,CAAP,KAAa,WAApB;EAAkC,CARtD,EASFvB,MATE,CASK,UAAUwB,IAAV,EAAgBhB,MAAhB,EAAwB;IAChCgB,IAAI,CAAChB,MAAM,CAACL,EAAR,CAAJ,GAAkBK,MAAlB,CADgC,CACN;;IAC1B,OAAOgB,IAAP;EACH,CAZM,EAYJ,EAZI,CAAP;AAaH,CAzBM;AA0BP,OAAO,IAAIC,kBAAkB,GAAG,UAAUd,KAAV,EAAiBM,SAAjB,EAA4Bb,GAA5B,EAAiC;EAC7D,IAAIA,GAAG,CAACxB,MAAJ,KAAe,CAAnB,EAAsB;IAClB,OAAO,EAAP;EACH;;EACD,IAAI,CAAC+B,KAAK,CAACC,KAAN,CAAYO,SAAZ,CAAsBF,SAAtB,CAAL,EAAuC;IACnC;IACAG,OAAO,CAACC,KAAR,CAAc,wBAAwBJ,SAAxB,GAAoC,MAApC,IACT,sEAAsEA,SAAtE,GAAkF,MADzE,IAEV,iCAFU,GAGV,0FAHJ,EAGgG;MAAEb,GAAG,EAAEA;IAAP,CAHhG;EAIH;;EACD,IAAIS,UAAU,GAAGT,GAAG,CACfG,GADY,CACR,UAAUJ,EAAV,EAAc;IACnB,IAAIL,QAAQ,GAAGa,KAAK,CAACC,KAAN,CAAYO,SAAZ,CAAsBF,SAAtB,CAAf;;IACA,IAAI,CAACnB,QAAL,EAAe;MACX,OAAOoB,SAAP;IACH;;IACD,OAAOpB,QAAQ,CAACQ,IAAT,CAAcH,EAAd,CAAP;EACH,CAPgB,EAQZmB,MARY,CAQL,UAAUC,CAAV,EAAa;IAAE,OAAO,OAAOA,CAAP,KAAa,WAApB;EAAkC,CAR5C,EASZvB,MATY,CASL,UAAUwB,IAAV,EAAgBhB,MAAhB,EAAwB;IAChCgB,IAAI,CAAChB,MAAM,CAACL,EAAR,CAAJ,GAAkBK,MAAlB,CADgC,CACN;;IAC1B,OAAOgB,IAAP;EACH,CAZgB,EAYd,EAZc,CAAjB;EAaA,OAAOnD,MAAM,CAACqD,IAAP,CAAYb,UAAZ,EAAwBjC,MAAxB,GAAiC,CAAjC,GAAqCiC,UAArC,GAAkD,IAAzD;AACH,CAzBM;;AA0BP,IAAIhB,oBAAoB,GAAG,UAAUN,aAAV,EAAyBO,QAAzB,EAAmC;EAAE,OAAOzB,MAAM,CAACqD,IAAP,CAAYnC,aAAZ,EAA2B+B,MAA3B,CAAkC,UAAUK,GAAV,EAAe;IAAE,OAAOA,GAAG,CAACC,QAAJ,CAAa9B,QAAb,CAAP;EAAgC,CAAnF,CAAP;AAA8F,CAA9J;;AACA,IAAIG,uBAAuB,GAAG,UAAU4B,UAAV,EAAsB;EAAE,OAAO,UAAUtC,aAAV,EAAyBoC,GAAzB,EAA8B;IACvF,IAAIlC,EAAJ;;IACA,IAAIqC,SAAS,GAAGvC,aAAa,CAACoC,GAAD,CAAb,CAAmBvB,GAAnB,CAAuBkB,MAAvB,CAA8B,UAAUnB,EAAV,EAAc;MAAE,OAAO,CAAC0B,UAAU,CAACD,QAAX,CAAoBzB,EAApB,CAAR;IAAkC,CAAhF,CAAhB;;IACA,IAAI2B,SAAS,CAAClD,MAAV,KAAqBW,aAAa,CAACoC,GAAD,CAAb,CAAmBvB,GAAnB,CAAuBxB,MAAhD,EAAwD;MACpD,OAAOW,aAAP;IACH;;IACD,OAAOnB,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKmB,aAAL,CAAT,GAA+BE,EAAE,GAAG,EAAL,EAASA,EAAE,CAACkC,GAAD,CAAF,GAAU;MAC7DvB,GAAG,EAAE0B,SADwD;MAE7DrB,KAAK,EAAEqB,SAAS,CAAClD;IAF4C,CAAnB,EAG3Ca,EAHY,EAAf;EAIH,CAVqD;AAUlD,CAVJ;;AAWA,OAAO,IAAIsC,aAAa,GAAG,UAAUd,SAAV,EAAqBd,EAArB,EAAyBL,QAAzB,EAAmCkC,MAAnC,EAA2CV,MAA3C,EAAmD;EAC1E,IAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;IAAEA,MAAM,GAAG,EAAT;EAAc;;EACvC,IAAII,IAAI,GAAGrD,MAAM,CAACqD,IAAP,CAAYJ,MAAZ,CAAX;;EACA,IAAI,CAACI,IAAI,CAAC9C,MAAV,EAAkB;IACd,OAAOkB,QAAQ,GAAG,GAAX,GAAiBmB,SAAjB,GAA6B,GAA7B,GAAmCe,MAAnC,GAA4C,GAA5C,GAAkD7B,EAAzD;EACH;;EACD,OAAOL,QAAQ,GAAG,GAAX,GAAiBmB,SAAjB,GAA6B,GAA7B,GAAmCe,MAAnC,GAA4C,GAA5C,GAAkD7B,EAAlD,GAAuD,GAAvD,GAA6DuB,IAAI,CACnEnB,GAD+D,CAC3D,UAAUoB,GAAV,EAAe;IAAE,OAAOA,GAAG,GAAG,GAAN,GAAYM,IAAI,CAACC,SAAL,CAAeZ,MAAM,CAACK,GAAD,CAArB,CAAnB;EAAiD,CADP,EAE/DQ,IAF+D,CAE1D,GAF0D,CAApE;AAGH,CATM;AAUP,eAAe7C,gBAAf"},"metadata":{},"sourceType":"module"}