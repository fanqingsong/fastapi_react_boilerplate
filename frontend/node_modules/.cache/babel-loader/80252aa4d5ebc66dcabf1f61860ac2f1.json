{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport { useMemo, useEffect, useRef, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport isEqual from 'lodash/isEqual';\nimport difference from 'lodash/difference';\nimport { useGetMany } from '../../dataProvider';\nimport { useForm } from 'react-final-form';\nimport useGetMatching from '../../dataProvider/useGetMatching';\nimport { useTranslate } from '../../i18n';\nimport { getStatusForArrayInput as getDataStatus } from './referenceDataStatus';\nimport { useResourceContext } from '../../core';\nimport { usePaginationState, useSortState } from '..';\nimport { indexById, removeEmpty, useSafeSetState } from '../../util';\n/**\n * Prepare data for the ReferenceArrayInput components\n *\n * @example\n *\n * const { choices, error, loaded, loading } = useReferenceArrayInputController({\n *      basePath: 'resource';\n *      record: { referenceIds: ['id1', 'id2']};\n *      reference: 'reference';\n *      resource: 'resource';\n *      source: 'referenceIds';\n * });\n *\n * @param {Object} props\n * @param {string} props.basePath basepath to current resource\n * @param {Object} props.record The current resource record\n * @param {string} props.reference The linked resource name\n * @param {string} props.resource The current resource name\n * @param {string} props.source The key of the linked resource identifier\n *\n * @param {Props} props\n *\n * @return {Object} controllerProps Fetched data and callbacks for the ReferenceArrayInput components\n */\n\nexport var useReferenceArrayInputController = function (props) {\n  var defaultFilter = props.filter,\n      _a = props.filterToQuery,\n      filterToQuery = _a === void 0 ? defaultFilterToQuery : _a,\n      input = props.input,\n      _b = props.page,\n      initialPage = _b === void 0 ? 1 : _b,\n      _c = props.perPage,\n      initialPerPage = _c === void 0 ? 25 : _c,\n      _d = props.sort,\n      initialSort = _d === void 0 ? {\n    field: 'id',\n    order: 'DESC'\n  } : _d,\n      options = props.options,\n      reference = props.reference,\n      source = props.source,\n      enableGetChoices = props.enableGetChoices;\n  var resource = useResourceContext(props);\n  var translate = useTranslate(); // We store the current input value in a ref so that we are able to fetch\n  // only the missing references when the input value changes\n\n  var inputValue = useRef(input.value);\n\n  var _e = useSafeSetState(input.value),\n      idsToFetch = _e[0],\n      setIdsToFetch = _e[1];\n\n  var _f = useSafeSetState(EmptyArray),\n      idsToGetFromStore = _f[0],\n      setIdsToGetFromStore = _f[1];\n\n  var referenceRecordsFromStore = useSelector(function (state) {\n    return idsToGetFromStore.map(function (id) {\n      return state.admin.resources[reference].data[id];\n    });\n  }); // optimization: we fetch selected items only once. When the user selects more items,\n  // as we already have the past selected items in the store, we don't fetch them.\n\n  useEffect(function () {\n    // Only fetch new ids\n    var newIdsToFetch = difference(input.value, inputValue.current); // Only get from store ids selected and already fetched\n\n    var newIdsToGetFromStore = difference(input.value, newIdsToFetch);\n    /*\n        input.value (current)\n            +------------------------+\n            | ********************** |\n            | ********************** |  inputValue.current (old)\n            | ********** +-----------------------+\n            | ********** | ooooooooo |           |\n            | ********** | ooooooooo |           |\n            | ********** | ooooooooo |           |\n            | ********** | ooooooooo |           |\n            +---|--------|------|----+           |\n                |        |      |                |\n                |        |      |                |\n                |        +------|----------------+\n                |               |\n        newIdsToFetch    newIdsToGetFromStore\n    */\n    // Change states each time input values changes to avoid keeping previous values no more selected\n\n    if (!isEqual(idsToFetch, newIdsToFetch)) {\n      setIdsToFetch(newIdsToFetch);\n    }\n\n    if (!isEqual(idsToGetFromStore, newIdsToGetFromStore)) {\n      setIdsToGetFromStore(newIdsToGetFromStore);\n    }\n\n    inputValue.current = input.value;\n  }, [idsToFetch, idsToGetFromStore, input.value, setIdsToFetch, setIdsToGetFromStore]); // pagination logic\n\n  var _g = usePaginationState({\n    page: initialPage,\n    perPage: initialPerPage\n  }),\n      page = _g.page,\n      setPage = _g.setPage,\n      perPage = _g.perPage,\n      setPerPage = _g.setPerPage,\n      pagination = _g.pagination,\n      setPagination = _g.setPagination;\n\n  var form = useForm();\n  var onSelect = useCallback(function (newIds) {\n    // This could happen when user unselect all items using the datagrid for instance\n    if (newIds.length === 0) {\n      form.change(input.name, EmptyArray);\n      return;\n    }\n\n    var newValue = new Set(input.value);\n    newIds.forEach(function (newId) {\n      newValue.add(newId);\n    });\n    form.change(input.name, Array.from(newValue));\n  }, [form, input.value, input.name]);\n  var onUnselectItems = useCallback(function () {\n    form.change(input.name, EmptyArray);\n  }, [form, input.name]);\n  var onToggleItem = useCallback(function (id) {\n    if (input.value.some(function (selectedId) {\n      return selectedId === id;\n    })) {\n      form.change(input.name, input.value.filter(function (selectedId) {\n        return selectedId !== id;\n      }));\n    } else {\n      form.change(input.name, __spreadArray(__spreadArray([], input.value, true), [id], false));\n    }\n  }, [form, input.name, input.value]); // sort logic\n\n  var sortRef = useRef(initialSort);\n\n  var _h = useSortState(initialSort),\n      sort = _h.sort,\n      setSort = _h.setSort; // ReferenceArrayInput.setSort had a different signature than the one from ListContext.\n  // In order to not break backward compatibility, we added this temporary setSortForList in the\n  // ReferenceArrayInputContext\n\n\n  var setSortForList = useCallback(function (field, order) {\n    if (order === void 0) {\n      order = 'ASC';\n    }\n\n    setSort({\n      field: field,\n      order: order\n    });\n    setPage(1);\n  }, [setPage, setSort]); // Ensure sort can be updated through props too, not just by using the setSort function\n\n  useEffect(function () {\n    if (!isEqual(initialSort, sortRef.current)) {\n      setSort(initialSort);\n    }\n  }, [setSort, initialSort]); // Ensure pagination can be updated through props too, not just by using the setPagination function\n\n  var paginationRef = useRef({\n    initialPage: initialPage,\n    initialPerPage: initialPerPage\n  });\n  useEffect(function () {\n    if (!isEqual({\n      initialPage: initialPage,\n      initialPerPage: initialPerPage\n    }, paginationRef.current)) {\n      setPagination({\n        page: initialPage,\n        perPage: initialPerPage\n      });\n    }\n  }, [setPagination, initialPage, initialPerPage]); // filter logic\n\n  var _j = useSafeSetState(''),\n      queryFilter = _j[0],\n      setFilter = _j[1];\n\n  var filterRef = useRef(defaultFilter);\n\n  var _k = useSafeSetState({}),\n      displayedFilters = _k[0],\n      setDisplayedFilters = _k[1];\n\n  var _l = useSafeSetState(defaultFilter),\n      filterValues = _l[0],\n      setFilterValues = _l[1];\n\n  var hideFilter = useCallback(function (filterName) {\n    setDisplayedFilters(function (previousState) {\n      var _a = previousState,\n          _b = filterName,\n          _ = _a[_b],\n          newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n      return newState;\n    });\n    setFilterValues(function (previousState) {\n      var _a = previousState,\n          _b = filterName,\n          _ = _a[_b],\n          newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n      return newState;\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    setDisplayedFilters(function (previousState) {\n      var _a;\n\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a));\n    });\n    setFilterValues(function (previousState) {\n      var _a;\n\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a));\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var setFilters = useCallback(function (filters, displayedFilters) {\n    setFilterValues(removeEmpty(filters));\n    setDisplayedFilters(displayedFilters);\n    setPage(1);\n  }, [setDisplayedFilters, setFilterValues, setPage]); // handle filter prop change\n\n  useEffect(function () {\n    if (!isEqual(defaultFilter, filterRef.current)) {\n      filterRef.current = defaultFilter;\n      setFilterValues(defaultFilter);\n    }\n  }); // Merge the user filters with the default ones\n\n  var finalFilter = useMemo(function () {\n    return __assign(__assign({}, defaultFilter), filterToQuery(queryFilter));\n  }, [queryFilter, defaultFilter, filterToQuery]);\n\n  var _m = useGetMany(reference, idsToFetch || EmptyArray),\n      referenceRecordsFetched = _m.data,\n      loaded = _m.loaded,\n      refetchGetMany = _m.refetch;\n\n  var referenceRecords = referenceRecordsFetched ? referenceRecordsFetched.concat(referenceRecordsFromStore) : referenceRecordsFromStore; // filter out not found references - happens when the dataProvider doesn't guarantee referential integrity\n\n  var finalReferenceRecords = referenceRecords.filter(Boolean);\n  var isGetMatchingEnabled = enableGetChoices ? enableGetChoices(finalFilter) : true;\n\n  var _o = useGetMatching(reference, pagination, sort, finalFilter, source, resource, options ? __assign(__assign({}, options), {\n    enabled: isGetMatchingEnabled\n  }) : {\n    enabled: isGetMatchingEnabled\n  }),\n      matchingReferences = _o.data,\n      matchingReferencesIds = _o.ids,\n      total = _o.total,\n      refetchGetMatching = _o.refetch; // We merge the currently selected records with the matching ones, otherwise\n  // the component displaying the currently selected records may fail\n\n\n  var finalMatchingReferences = matchingReferences && matchingReferences.length > 0 ? mergeReferences(matchingReferences, finalReferenceRecords) : finalReferenceRecords.length > 0 ? finalReferenceRecords : matchingReferences;\n  var dataStatus = getDataStatus({\n    input: input,\n    matchingReferences: finalMatchingReferences,\n    referenceRecords: finalReferenceRecords,\n    translate: translate\n  });\n  var refetch = useCallback(function () {\n    refetchGetMany();\n    refetchGetMatching();\n  }, [refetchGetMany, refetchGetMatching]);\n  return {\n    basePath: props.basePath || \"/\" + resource,\n    choices: dataStatus.choices,\n    currentSort: sort,\n    // For the ListContext, we don't want to always display the selected items first.\n    // Indeed it wouldn't work well regarding sorting and pagination\n    data: matchingReferences && matchingReferences.length > 0 ? indexById(matchingReferences) : {},\n    displayedFilters: displayedFilters,\n    error: dataStatus.error,\n    filterValues: filterValues,\n    hasCreate: false,\n    hideFilter: hideFilter,\n    // For the ListContext, we don't want to always display the selected items first.\n    // Indeed it wouldn't work well regarding sorting and pagination\n    ids: matchingReferencesIds || EmptyArray,\n    loaded: loaded,\n    loading: dataStatus.waiting && isGetMatchingEnabled,\n    onSelect: onSelect,\n    onToggleItem: onToggleItem,\n    onUnselectItems: onUnselectItems,\n    page: page,\n    perPage: perPage,\n    refetch: refetch,\n    resource: resource,\n    selectedIds: input.value || EmptyArray,\n    setFilter: setFilter,\n    setFilters: setFilters,\n    setPage: setPage,\n    setPagination: setPagination,\n    setPerPage: setPerPage,\n    setSort: setSort,\n    setSortForList: setSortForList,\n    showFilter: showFilter,\n    warning: dataStatus.warning,\n    total: total\n  };\n};\nvar EmptyArray = []; // concatenate and deduplicate two lists of records\n\nvar mergeReferences = function (ref1, ref2) {\n  var res = __spreadArray([], ref1, true);\n\n  var ids = ref1.map(function (ref) {\n    return ref.id;\n  });\n  ref2.forEach(function (ref) {\n    if (!ids.includes(ref.id)) {\n      ids.push(ref.id);\n      res.push(ref);\n    }\n  });\n  return res;\n};\n\nvar defaultFilterToQuery = function (searchText) {\n  return {\n    q: searchText\n  };\n};","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__spreadArray","to","from","pack","l","ar","Array","slice","concat","useMemo","useEffect","useRef","useCallback","useSelector","isEqual","difference","useGetMany","useForm","useGetMatching","useTranslate","getStatusForArrayInput","getDataStatus","useResourceContext","usePaginationState","useSortState","indexById","removeEmpty","useSafeSetState","useReferenceArrayInputController","props","defaultFilter","filter","_a","filterToQuery","defaultFilterToQuery","input","_b","page","initialPage","_c","perPage","initialPerPage","_d","sort","initialSort","field","order","options","reference","source","enableGetChoices","resource","translate","inputValue","value","_e","idsToFetch","setIdsToFetch","_f","EmptyArray","idsToGetFromStore","setIdsToGetFromStore","referenceRecordsFromStore","state","map","id","admin","resources","data","newIdsToFetch","current","newIdsToGetFromStore","_g","setPage","setPerPage","pagination","setPagination","form","onSelect","newIds","change","name","newValue","Set","forEach","newId","add","onUnselectItems","onToggleItem","some","selectedId","sortRef","_h","setSort","setSortForList","paginationRef","_j","queryFilter","setFilter","filterRef","_k","displayedFilters","setDisplayedFilters","_l","filterValues","setFilterValues","hideFilter","filterName","previousState","_","newState","showFilter","defaultValue","setFilters","filters","finalFilter","_m","referenceRecordsFetched","loaded","refetchGetMany","refetch","referenceRecords","finalReferenceRecords","Boolean","isGetMatchingEnabled","_o","enabled","matchingReferences","matchingReferencesIds","ids","total","refetchGetMatching","finalMatchingReferences","mergeReferences","dataStatus","basePath","choices","currentSort","error","hasCreate","loading","waiting","selectedIds","warning","ref1","ref2","res","ref","includes","push","searchText","q"],"sources":["/app/node_modules/ra-core/esm/controller/input/useReferenceArrayInputController.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { useMemo, useEffect, useRef, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport isEqual from 'lodash/isEqual';\nimport difference from 'lodash/difference';\nimport { useGetMany } from '../../dataProvider';\nimport { useForm } from 'react-final-form';\nimport useGetMatching from '../../dataProvider/useGetMatching';\nimport { useTranslate } from '../../i18n';\nimport { getStatusForArrayInput as getDataStatus } from './referenceDataStatus';\nimport { useResourceContext } from '../../core';\nimport { usePaginationState, useSortState } from '..';\nimport { indexById, removeEmpty, useSafeSetState } from '../../util';\n/**\n * Prepare data for the ReferenceArrayInput components\n *\n * @example\n *\n * const { choices, error, loaded, loading } = useReferenceArrayInputController({\n *      basePath: 'resource';\n *      record: { referenceIds: ['id1', 'id2']};\n *      reference: 'reference';\n *      resource: 'resource';\n *      source: 'referenceIds';\n * });\n *\n * @param {Object} props\n * @param {string} props.basePath basepath to current resource\n * @param {Object} props.record The current resource record\n * @param {string} props.reference The linked resource name\n * @param {string} props.resource The current resource name\n * @param {string} props.source The key of the linked resource identifier\n *\n * @param {Props} props\n *\n * @return {Object} controllerProps Fetched data and callbacks for the ReferenceArrayInput components\n */\nexport var useReferenceArrayInputController = function (props) {\n    var defaultFilter = props.filter, _a = props.filterToQuery, filterToQuery = _a === void 0 ? defaultFilterToQuery : _a, input = props.input, _b = props.page, initialPage = _b === void 0 ? 1 : _b, _c = props.perPage, initialPerPage = _c === void 0 ? 25 : _c, _d = props.sort, initialSort = _d === void 0 ? { field: 'id', order: 'DESC' } : _d, options = props.options, reference = props.reference, source = props.source, enableGetChoices = props.enableGetChoices;\n    var resource = useResourceContext(props);\n    var translate = useTranslate();\n    // We store the current input value in a ref so that we are able to fetch\n    // only the missing references when the input value changes\n    var inputValue = useRef(input.value);\n    var _e = useSafeSetState(input.value), idsToFetch = _e[0], setIdsToFetch = _e[1];\n    var _f = useSafeSetState(EmptyArray), idsToGetFromStore = _f[0], setIdsToGetFromStore = _f[1];\n    var referenceRecordsFromStore = useSelector(function (state) {\n        return idsToGetFromStore.map(function (id) { return state.admin.resources[reference].data[id]; });\n    });\n    // optimization: we fetch selected items only once. When the user selects more items,\n    // as we already have the past selected items in the store, we don't fetch them.\n    useEffect(function () {\n        // Only fetch new ids\n        var newIdsToFetch = difference(input.value, inputValue.current);\n        // Only get from store ids selected and already fetched\n        var newIdsToGetFromStore = difference(input.value, newIdsToFetch);\n        /*\n            input.value (current)\n                +------------------------+\n                | ********************** |\n                | ********************** |  inputValue.current (old)\n                | ********** +-----------------------+\n                | ********** | ooooooooo |           |\n                | ********** | ooooooooo |           |\n                | ********** | ooooooooo |           |\n                | ********** | ooooooooo |           |\n                +---|--------|------|----+           |\n                    |        |      |                |\n                    |        |      |                |\n                    |        +------|----------------+\n                    |               |\n            newIdsToFetch    newIdsToGetFromStore\n        */\n        // Change states each time input values changes to avoid keeping previous values no more selected\n        if (!isEqual(idsToFetch, newIdsToFetch)) {\n            setIdsToFetch(newIdsToFetch);\n        }\n        if (!isEqual(idsToGetFromStore, newIdsToGetFromStore)) {\n            setIdsToGetFromStore(newIdsToGetFromStore);\n        }\n        inputValue.current = input.value;\n    }, [\n        idsToFetch,\n        idsToGetFromStore,\n        input.value,\n        setIdsToFetch,\n        setIdsToGetFromStore,\n    ]);\n    // pagination logic\n    var _g = usePaginationState({\n        page: initialPage,\n        perPage: initialPerPage,\n    }), page = _g.page, setPage = _g.setPage, perPage = _g.perPage, setPerPage = _g.setPerPage, pagination = _g.pagination, setPagination = _g.setPagination;\n    var form = useForm();\n    var onSelect = useCallback(function (newIds) {\n        // This could happen when user unselect all items using the datagrid for instance\n        if (newIds.length === 0) {\n            form.change(input.name, EmptyArray);\n            return;\n        }\n        var newValue = new Set(input.value);\n        newIds.forEach(function (newId) {\n            newValue.add(newId);\n        });\n        form.change(input.name, Array.from(newValue));\n    }, [form, input.value, input.name]);\n    var onUnselectItems = useCallback(function () {\n        form.change(input.name, EmptyArray);\n    }, [form, input.name]);\n    var onToggleItem = useCallback(function (id) {\n        if (input.value.some(function (selectedId) { return selectedId === id; })) {\n            form.change(input.name, input.value.filter(function (selectedId) { return selectedId !== id; }));\n        }\n        else {\n            form.change(input.name, __spreadArray(__spreadArray([], input.value, true), [id], false));\n        }\n    }, [form, input.name, input.value]);\n    // sort logic\n    var sortRef = useRef(initialSort);\n    var _h = useSortState(initialSort), sort = _h.sort, setSort = _h.setSort;\n    // ReferenceArrayInput.setSort had a different signature than the one from ListContext.\n    // In order to not break backward compatibility, we added this temporary setSortForList in the\n    // ReferenceArrayInputContext\n    var setSortForList = useCallback(function (field, order) {\n        if (order === void 0) { order = 'ASC'; }\n        setSort({ field: field, order: order });\n        setPage(1);\n    }, [setPage, setSort]);\n    // Ensure sort can be updated through props too, not just by using the setSort function\n    useEffect(function () {\n        if (!isEqual(initialSort, sortRef.current)) {\n            setSort(initialSort);\n        }\n    }, [setSort, initialSort]);\n    // Ensure pagination can be updated through props too, not just by using the setPagination function\n    var paginationRef = useRef({ initialPage: initialPage, initialPerPage: initialPerPage });\n    useEffect(function () {\n        if (!isEqual({ initialPage: initialPage, initialPerPage: initialPerPage }, paginationRef.current)) {\n            setPagination({ page: initialPage, perPage: initialPerPage });\n        }\n    }, [setPagination, initialPage, initialPerPage]);\n    // filter logic\n    var _j = useSafeSetState(''), queryFilter = _j[0], setFilter = _j[1];\n    var filterRef = useRef(defaultFilter);\n    var _k = useSafeSetState({}), displayedFilters = _k[0], setDisplayedFilters = _k[1];\n    var _l = useSafeSetState(defaultFilter), filterValues = _l[0], setFilterValues = _l[1];\n    var hideFilter = useCallback(function (filterName) {\n        setDisplayedFilters(function (previousState) {\n            var _a = previousState, _b = filterName, _ = _a[_b], newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n            return newState;\n        });\n        setFilterValues(function (previousState) {\n            var _a = previousState, _b = filterName, _ = _a[_b], newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n            return newState;\n        });\n    }, [setDisplayedFilters, setFilterValues]);\n    var showFilter = useCallback(function (filterName, defaultValue) {\n        setDisplayedFilters(function (previousState) {\n            var _a;\n            return (__assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a)));\n        });\n        setFilterValues(function (previousState) {\n            var _a;\n            return (__assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a)));\n        });\n    }, [setDisplayedFilters, setFilterValues]);\n    var setFilters = useCallback(function (filters, displayedFilters) {\n        setFilterValues(removeEmpty(filters));\n        setDisplayedFilters(displayedFilters);\n        setPage(1);\n    }, [setDisplayedFilters, setFilterValues, setPage]);\n    // handle filter prop change\n    useEffect(function () {\n        if (!isEqual(defaultFilter, filterRef.current)) {\n            filterRef.current = defaultFilter;\n            setFilterValues(defaultFilter);\n        }\n    });\n    // Merge the user filters with the default ones\n    var finalFilter = useMemo(function () { return (__assign(__assign({}, defaultFilter), filterToQuery(queryFilter))); }, [queryFilter, defaultFilter, filterToQuery]);\n    var _m = useGetMany(reference, idsToFetch || EmptyArray), referenceRecordsFetched = _m.data, loaded = _m.loaded, refetchGetMany = _m.refetch;\n    var referenceRecords = referenceRecordsFetched\n        ? referenceRecordsFetched.concat(referenceRecordsFromStore)\n        : referenceRecordsFromStore;\n    // filter out not found references - happens when the dataProvider doesn't guarantee referential integrity\n    var finalReferenceRecords = referenceRecords.filter(Boolean);\n    var isGetMatchingEnabled = enableGetChoices\n        ? enableGetChoices(finalFilter)\n        : true;\n    var _o = useGetMatching(reference, pagination, sort, finalFilter, source, resource, options\n        ? __assign(__assign({}, options), { enabled: isGetMatchingEnabled }) : { enabled: isGetMatchingEnabled }), matchingReferences = _o.data, matchingReferencesIds = _o.ids, total = _o.total, refetchGetMatching = _o.refetch;\n    // We merge the currently selected records with the matching ones, otherwise\n    // the component displaying the currently selected records may fail\n    var finalMatchingReferences = matchingReferences && matchingReferences.length > 0\n        ? mergeReferences(matchingReferences, finalReferenceRecords)\n        : finalReferenceRecords.length > 0\n            ? finalReferenceRecords\n            : matchingReferences;\n    var dataStatus = getDataStatus({\n        input: input,\n        matchingReferences: finalMatchingReferences,\n        referenceRecords: finalReferenceRecords,\n        translate: translate,\n    });\n    var refetch = useCallback(function () {\n        refetchGetMany();\n        refetchGetMatching();\n    }, [refetchGetMany, refetchGetMatching]);\n    return {\n        basePath: props.basePath || \"/\" + resource,\n        choices: dataStatus.choices,\n        currentSort: sort,\n        // For the ListContext, we don't want to always display the selected items first.\n        // Indeed it wouldn't work well regarding sorting and pagination\n        data: matchingReferences && matchingReferences.length > 0\n            ? indexById(matchingReferences)\n            : {},\n        displayedFilters: displayedFilters,\n        error: dataStatus.error,\n        filterValues: filterValues,\n        hasCreate: false,\n        hideFilter: hideFilter,\n        // For the ListContext, we don't want to always display the selected items first.\n        // Indeed it wouldn't work well regarding sorting and pagination\n        ids: matchingReferencesIds || EmptyArray,\n        loaded: loaded,\n        loading: dataStatus.waiting && isGetMatchingEnabled,\n        onSelect: onSelect,\n        onToggleItem: onToggleItem,\n        onUnselectItems: onUnselectItems,\n        page: page,\n        perPage: perPage,\n        refetch: refetch,\n        resource: resource,\n        selectedIds: input.value || EmptyArray,\n        setFilter: setFilter,\n        setFilters: setFilters,\n        setPage: setPage,\n        setPagination: setPagination,\n        setPerPage: setPerPage,\n        setSort: setSort,\n        setSortForList: setSortForList,\n        showFilter: showFilter,\n        warning: dataStatus.warning,\n        total: total,\n    };\n};\nvar EmptyArray = [];\n// concatenate and deduplicate two lists of records\nvar mergeReferences = function (ref1, ref2) {\n    var res = __spreadArray([], ref1, true);\n    var ids = ref1.map(function (ref) { return ref.id; });\n    ref2.forEach(function (ref) {\n        if (!ids.includes(ref.id)) {\n            ids.push(ref.id);\n            res.push(ref);\n        }\n    });\n    return res;\n};\nvar defaultFilterToQuery = function (searchText) { return ({ q: searchText }); };\n"],"mappings":"AAAA,IAAIA,QAAQ,GAAI,QAAQ,KAAKA,QAAd,IAA2B,YAAY;EAClDA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAASC,CAAT,EAAY;IACpC,KAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;MACjDD,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;MACA,KAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;IACP;;IACD,OAAON,CAAP;EACH,CAPD;;EAQA,OAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CAVD;;AAWA,IAAIO,MAAM,GAAI,QAAQ,KAAKA,MAAd,IAAyB,UAAUV,CAAV,EAAaW,CAAb,EAAgB;EAClD,IAAIZ,CAAC,GAAG,EAAR;;EACA,KAAK,IAAIM,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,KAA8CM,CAAC,CAACC,OAAF,CAAUP,CAAV,IAAe,CAAjE,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;;EACJ,IAAIL,CAAC,IAAI,IAAL,IAAa,OAAOH,MAAM,CAACgB,qBAAd,KAAwC,UAAzD,EACI,KAAK,IAAIZ,CAAC,GAAG,CAAR,EAAWI,CAAC,GAAGR,MAAM,CAACgB,qBAAP,CAA6Bb,CAA7B,CAApB,EAAqDC,CAAC,GAAGI,CAAC,CAACD,MAA3D,EAAmEH,CAAC,EAApE,EAAwE;IACpE,IAAIU,CAAC,CAACC,OAAF,CAAUP,CAAC,CAACJ,CAAD,CAAX,IAAkB,CAAlB,IAAuBJ,MAAM,CAACS,SAAP,CAAiBQ,oBAAjB,CAAsCN,IAAtC,CAA2CR,CAA3C,EAA8CK,CAAC,CAACJ,CAAD,CAA/C,CAA3B,EACIF,CAAC,CAACM,CAAC,CAACJ,CAAD,CAAF,CAAD,GAAUD,CAAC,CAACK,CAAC,CAACJ,CAAD,CAAF,CAAX;EACP;EACL,OAAOF,CAAP;AACH,CAVD;;AAWA,IAAIgB,aAAa,GAAI,QAAQ,KAAKA,aAAd,IAAgC,UAAUC,EAAV,EAAcC,IAAd,EAAoBC,IAApB,EAA0B;EAC1E,IAAIA,IAAI,IAAIf,SAAS,CAACC,MAAV,KAAqB,CAAjC,EAAoC,KAAK,IAAIH,CAAC,GAAG,CAAR,EAAWkB,CAAC,GAAGF,IAAI,CAACb,MAApB,EAA4BgB,EAAjC,EAAqCnB,CAAC,GAAGkB,CAAzC,EAA4ClB,CAAC,EAA7C,EAAiD;IACjF,IAAImB,EAAE,IAAI,EAAEnB,CAAC,IAAIgB,IAAP,CAAV,EAAwB;MACpB,IAAI,CAACG,EAAL,EAASA,EAAE,GAAGC,KAAK,CAACf,SAAN,CAAgBgB,KAAhB,CAAsBd,IAAtB,CAA2BS,IAA3B,EAAiC,CAAjC,EAAoChB,CAApC,CAAL;MACTmB,EAAE,CAACnB,CAAD,CAAF,GAAQgB,IAAI,CAAChB,CAAD,CAAZ;IACH;EACJ;EACD,OAAOe,EAAE,CAACO,MAAH,CAAUH,EAAE,IAAIC,KAAK,CAACf,SAAN,CAAgBgB,KAAhB,CAAsBd,IAAtB,CAA2BS,IAA3B,CAAhB,CAAP;AACH,CARD;;AASA,SAASO,OAAT,EAAkBC,SAAlB,EAA6BC,MAA7B,EAAqCC,WAArC,QAAwD,OAAxD;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,OAAOC,OAAP,MAAoB,gBAApB;AACA,OAAOC,UAAP,MAAuB,mBAAvB;AACA,SAASC,UAAT,QAA2B,oBAA3B;AACA,SAASC,OAAT,QAAwB,kBAAxB;AACA,OAAOC,cAAP,MAA2B,mCAA3B;AACA,SAASC,YAAT,QAA6B,YAA7B;AACA,SAASC,sBAAsB,IAAIC,aAAnC,QAAwD,uBAAxD;AACA,SAASC,kBAAT,QAAmC,YAAnC;AACA,SAASC,kBAAT,EAA6BC,YAA7B,QAAiD,IAAjD;AACA,SAASC,SAAT,EAAoBC,WAApB,EAAiCC,eAAjC,QAAwD,YAAxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,IAAIC,gCAAgC,GAAG,UAAUC,KAAV,EAAiB;EAC3D,IAAIC,aAAa,GAAGD,KAAK,CAACE,MAA1B;EAAA,IAAkCC,EAAE,GAAGH,KAAK,CAACI,aAA7C;EAAA,IAA4DA,aAAa,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgBE,oBAAhB,GAAuCF,EAAnH;EAAA,IAAuHG,KAAK,GAAGN,KAAK,CAACM,KAArI;EAAA,IAA4IC,EAAE,GAAGP,KAAK,CAACQ,IAAvJ;EAAA,IAA6JC,WAAW,GAAGF,EAAE,KAAK,KAAK,CAAZ,GAAgB,CAAhB,GAAoBA,EAA/L;EAAA,IAAmMG,EAAE,GAAGV,KAAK,CAACW,OAA9M;EAAA,IAAuNC,cAAc,GAAGF,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAA7P;EAAA,IAAiQG,EAAE,GAAGb,KAAK,CAACc,IAA5Q;EAAA,IAAkRC,WAAW,GAAGF,EAAE,KAAK,KAAK,CAAZ,GAAgB;IAAEG,KAAK,EAAE,IAAT;IAAeC,KAAK,EAAE;EAAtB,CAAhB,GAAiDJ,EAAjV;EAAA,IAAqVK,OAAO,GAAGlB,KAAK,CAACkB,OAArW;EAAA,IAA8WC,SAAS,GAAGnB,KAAK,CAACmB,SAAhY;EAAA,IAA2YC,MAAM,GAAGpB,KAAK,CAACoB,MAA1Z;EAAA,IAAkaC,gBAAgB,GAAGrB,KAAK,CAACqB,gBAA3b;EACA,IAAIC,QAAQ,GAAG7B,kBAAkB,CAACO,KAAD,CAAjC;EACA,IAAIuB,SAAS,GAAGjC,YAAY,EAA5B,CAH2D,CAI3D;EACA;;EACA,IAAIkC,UAAU,GAAG1C,MAAM,CAACwB,KAAK,CAACmB,KAAP,CAAvB;;EACA,IAAIC,EAAE,GAAG5B,eAAe,CAACQ,KAAK,CAACmB,KAAP,CAAxB;EAAA,IAAuCE,UAAU,GAAGD,EAAE,CAAC,CAAD,CAAtD;EAAA,IAA2DE,aAAa,GAAGF,EAAE,CAAC,CAAD,CAA7E;;EACA,IAAIG,EAAE,GAAG/B,eAAe,CAACgC,UAAD,CAAxB;EAAA,IAAsCC,iBAAiB,GAAGF,EAAE,CAAC,CAAD,CAA5D;EAAA,IAAiEG,oBAAoB,GAAGH,EAAE,CAAC,CAAD,CAA1F;;EACA,IAAII,yBAAyB,GAAGjD,WAAW,CAAC,UAAUkD,KAAV,EAAiB;IACzD,OAAOH,iBAAiB,CAACI,GAAlB,CAAsB,UAAUC,EAAV,EAAc;MAAE,OAAOF,KAAK,CAACG,KAAN,CAAYC,SAAZ,CAAsBnB,SAAtB,EAAiCoB,IAAjC,CAAsCH,EAAtC,CAAP;IAAmD,CAAzF,CAAP;EACH,CAF0C,CAA3C,CAT2D,CAY3D;EACA;;EACAvD,SAAS,CAAC,YAAY;IAClB;IACA,IAAI2D,aAAa,GAAGtD,UAAU,CAACoB,KAAK,CAACmB,KAAP,EAAcD,UAAU,CAACiB,OAAzB,CAA9B,CAFkB,CAGlB;;IACA,IAAIC,oBAAoB,GAAGxD,UAAU,CAACoB,KAAK,CAACmB,KAAP,EAAce,aAAd,CAArC;IACA;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQ;;IACA,IAAI,CAACvD,OAAO,CAAC0C,UAAD,EAAaa,aAAb,CAAZ,EAAyC;MACrCZ,aAAa,CAACY,aAAD,CAAb;IACH;;IACD,IAAI,CAACvD,OAAO,CAAC8C,iBAAD,EAAoBW,oBAApB,CAAZ,EAAuD;MACnDV,oBAAoB,CAACU,oBAAD,CAApB;IACH;;IACDlB,UAAU,CAACiB,OAAX,GAAqBnC,KAAK,CAACmB,KAA3B;EACH,CA9BQ,EA8BN,CACCE,UADD,EAECI,iBAFD,EAGCzB,KAAK,CAACmB,KAHP,EAICG,aAJD,EAKCI,oBALD,CA9BM,CAAT,CAd2D,CAmD3D;;EACA,IAAIW,EAAE,GAAGjD,kBAAkB,CAAC;IACxBc,IAAI,EAAEC,WADkB;IAExBE,OAAO,EAAEC;EAFe,CAAD,CAA3B;EAAA,IAGIJ,IAAI,GAAGmC,EAAE,CAACnC,IAHd;EAAA,IAGoBoC,OAAO,GAAGD,EAAE,CAACC,OAHjC;EAAA,IAG0CjC,OAAO,GAAGgC,EAAE,CAAChC,OAHvD;EAAA,IAGgEkC,UAAU,GAAGF,EAAE,CAACE,UAHhF;EAAA,IAG4FC,UAAU,GAAGH,EAAE,CAACG,UAH5G;EAAA,IAGwHC,aAAa,GAAGJ,EAAE,CAACI,aAH3I;;EAIA,IAAIC,IAAI,GAAG5D,OAAO,EAAlB;EACA,IAAI6D,QAAQ,GAAGlE,WAAW,CAAC,UAAUmE,MAAV,EAAkB;IACzC;IACA,IAAIA,MAAM,CAAC1F,MAAP,KAAkB,CAAtB,EAAyB;MACrBwF,IAAI,CAACG,MAAL,CAAY7C,KAAK,CAAC8C,IAAlB,EAAwBtB,UAAxB;MACA;IACH;;IACD,IAAIuB,QAAQ,GAAG,IAAIC,GAAJ,CAAQhD,KAAK,CAACmB,KAAd,CAAf;IACAyB,MAAM,CAACK,OAAP,CAAe,UAAUC,KAAV,EAAiB;MAC5BH,QAAQ,CAACI,GAAT,CAAaD,KAAb;IACH,CAFD;IAGAR,IAAI,CAACG,MAAL,CAAY7C,KAAK,CAAC8C,IAAlB,EAAwB3E,KAAK,CAACJ,IAAN,CAAWgF,QAAX,CAAxB;EACH,CAXyB,EAWvB,CAACL,IAAD,EAAO1C,KAAK,CAACmB,KAAb,EAAoBnB,KAAK,CAAC8C,IAA1B,CAXuB,CAA1B;EAYA,IAAIM,eAAe,GAAG3E,WAAW,CAAC,YAAY;IAC1CiE,IAAI,CAACG,MAAL,CAAY7C,KAAK,CAAC8C,IAAlB,EAAwBtB,UAAxB;EACH,CAFgC,EAE9B,CAACkB,IAAD,EAAO1C,KAAK,CAAC8C,IAAb,CAF8B,CAAjC;EAGA,IAAIO,YAAY,GAAG5E,WAAW,CAAC,UAAUqD,EAAV,EAAc;IACzC,IAAI9B,KAAK,CAACmB,KAAN,CAAYmC,IAAZ,CAAiB,UAAUC,UAAV,EAAsB;MAAE,OAAOA,UAAU,KAAKzB,EAAtB;IAA2B,CAApE,CAAJ,EAA2E;MACvEY,IAAI,CAACG,MAAL,CAAY7C,KAAK,CAAC8C,IAAlB,EAAwB9C,KAAK,CAACmB,KAAN,CAAYvB,MAAZ,CAAmB,UAAU2D,UAAV,EAAsB;QAAE,OAAOA,UAAU,KAAKzB,EAAtB;MAA2B,CAAtE,CAAxB;IACH,CAFD,MAGK;MACDY,IAAI,CAACG,MAAL,CAAY7C,KAAK,CAAC8C,IAAlB,EAAwBjF,aAAa,CAACA,aAAa,CAAC,EAAD,EAAKmC,KAAK,CAACmB,KAAX,EAAkB,IAAlB,CAAd,EAAuC,CAACW,EAAD,CAAvC,EAA6C,KAA7C,CAArC;IACH;EACJ,CAP6B,EAO3B,CAACY,IAAD,EAAO1C,KAAK,CAAC8C,IAAb,EAAmB9C,KAAK,CAACmB,KAAzB,CAP2B,CAA9B,CAxE2D,CAgF3D;;EACA,IAAIqC,OAAO,GAAGhF,MAAM,CAACiC,WAAD,CAApB;;EACA,IAAIgD,EAAE,GAAGpE,YAAY,CAACoB,WAAD,CAArB;EAAA,IAAoCD,IAAI,GAAGiD,EAAE,CAACjD,IAA9C;EAAA,IAAoDkD,OAAO,GAAGD,EAAE,CAACC,OAAjE,CAlF2D,CAmF3D;EACA;EACA;;;EACA,IAAIC,cAAc,GAAGlF,WAAW,CAAC,UAAUiC,KAAV,EAAiBC,KAAjB,EAAwB;IACrD,IAAIA,KAAK,KAAK,KAAK,CAAnB,EAAsB;MAAEA,KAAK,GAAG,KAAR;IAAgB;;IACxC+C,OAAO,CAAC;MAAEhD,KAAK,EAAEA,KAAT;MAAgBC,KAAK,EAAEA;IAAvB,CAAD,CAAP;IACA2B,OAAO,CAAC,CAAD,CAAP;EACH,CAJ+B,EAI7B,CAACA,OAAD,EAAUoB,OAAV,CAJ6B,CAAhC,CAtF2D,CA2F3D;;EACAnF,SAAS,CAAC,YAAY;IAClB,IAAI,CAACI,OAAO,CAAC8B,WAAD,EAAc+C,OAAO,CAACrB,OAAtB,CAAZ,EAA4C;MACxCuB,OAAO,CAACjD,WAAD,CAAP;IACH;EACJ,CAJQ,EAIN,CAACiD,OAAD,EAAUjD,WAAV,CAJM,CAAT,CA5F2D,CAiG3D;;EACA,IAAImD,aAAa,GAAGpF,MAAM,CAAC;IAAE2B,WAAW,EAAEA,WAAf;IAA4BG,cAAc,EAAEA;EAA5C,CAAD,CAA1B;EACA/B,SAAS,CAAC,YAAY;IAClB,IAAI,CAACI,OAAO,CAAC;MAAEwB,WAAW,EAAEA,WAAf;MAA4BG,cAAc,EAAEA;IAA5C,CAAD,EAA+DsD,aAAa,CAACzB,OAA7E,CAAZ,EAAmG;MAC/FM,aAAa,CAAC;QAAEvC,IAAI,EAAEC,WAAR;QAAqBE,OAAO,EAAEC;MAA9B,CAAD,CAAb;IACH;EACJ,CAJQ,EAIN,CAACmC,aAAD,EAAgBtC,WAAhB,EAA6BG,cAA7B,CAJM,CAAT,CAnG2D,CAwG3D;;EACA,IAAIuD,EAAE,GAAGrE,eAAe,CAAC,EAAD,CAAxB;EAAA,IAA8BsE,WAAW,GAAGD,EAAE,CAAC,CAAD,CAA9C;EAAA,IAAmDE,SAAS,GAAGF,EAAE,CAAC,CAAD,CAAjE;;EACA,IAAIG,SAAS,GAAGxF,MAAM,CAACmB,aAAD,CAAtB;;EACA,IAAIsE,EAAE,GAAGzE,eAAe,CAAC,EAAD,CAAxB;EAAA,IAA8B0E,gBAAgB,GAAGD,EAAE,CAAC,CAAD,CAAnD;EAAA,IAAwDE,mBAAmB,GAAGF,EAAE,CAAC,CAAD,CAAhF;;EACA,IAAIG,EAAE,GAAG5E,eAAe,CAACG,aAAD,CAAxB;EAAA,IAAyC0E,YAAY,GAAGD,EAAE,CAAC,CAAD,CAA1D;EAAA,IAA+DE,eAAe,GAAGF,EAAE,CAAC,CAAD,CAAnF;;EACA,IAAIG,UAAU,GAAG9F,WAAW,CAAC,UAAU+F,UAAV,EAAsB;IAC/CL,mBAAmB,CAAC,UAAUM,aAAV,EAAyB;MACzC,IAAI5E,EAAE,GAAG4E,aAAT;MAAA,IAAwBxE,EAAE,GAAGuE,UAA7B;MAAA,IAAyCE,CAAC,GAAG7E,EAAE,CAACI,EAAD,CAA/C;MAAA,IAAqD0E,QAAQ,GAAGnH,MAAM,CAACqC,EAAD,EAAK,CAAC,OAAOI,EAAP,KAAc,QAAd,GAAyBA,EAAzB,GAA8BA,EAAE,GAAG,EAApC,CAAL,CAAtE;;MACA,OAAO0E,QAAP;IACH,CAHkB,CAAnB;IAIAL,eAAe,CAAC,UAAUG,aAAV,EAAyB;MACrC,IAAI5E,EAAE,GAAG4E,aAAT;MAAA,IAAwBxE,EAAE,GAAGuE,UAA7B;MAAA,IAAyCE,CAAC,GAAG7E,EAAE,CAACI,EAAD,CAA/C;MAAA,IAAqD0E,QAAQ,GAAGnH,MAAM,CAACqC,EAAD,EAAK,CAAC,OAAOI,EAAP,KAAc,QAAd,GAAyBA,EAAzB,GAA8BA,EAAE,GAAG,EAApC,CAAL,CAAtE;;MACA,OAAO0E,QAAP;IACH,CAHc,CAAf;EAIH,CAT2B,EASzB,CAACR,mBAAD,EAAsBG,eAAtB,CATyB,CAA5B;EAUA,IAAIM,UAAU,GAAGnG,WAAW,CAAC,UAAU+F,UAAV,EAAsBK,YAAtB,EAAoC;IAC7DV,mBAAmB,CAAC,UAAUM,aAAV,EAAyB;MACzC,IAAI5E,EAAJ;;MACA,OAAQnD,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK+H,aAAL,CAAT,GAA+B5E,EAAE,GAAG,EAAL,EAASA,EAAE,CAAC2E,UAAD,CAAF,GAAiB,IAA1B,EAAgC3E,EAA/D,EAAhB;IACH,CAHkB,CAAnB;IAIAyE,eAAe,CAAC,UAAUG,aAAV,EAAyB;MACrC,IAAI5E,EAAJ;;MACA,OAAQnD,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK+H,aAAL,CAAT,GAA+B5E,EAAE,GAAG,EAAL,EAASA,EAAE,CAAC2E,UAAD,CAAF,GAAiBK,YAA1B,EAAwChF,EAAvE,EAAhB;IACH,CAHc,CAAf;EAIH,CAT2B,EASzB,CAACsE,mBAAD,EAAsBG,eAAtB,CATyB,CAA5B;EAUA,IAAIQ,UAAU,GAAGrG,WAAW,CAAC,UAAUsG,OAAV,EAAmBb,gBAAnB,EAAqC;IAC9DI,eAAe,CAAC/E,WAAW,CAACwF,OAAD,CAAZ,CAAf;IACAZ,mBAAmB,CAACD,gBAAD,CAAnB;IACA5B,OAAO,CAAC,CAAD,CAAP;EACH,CAJ2B,EAIzB,CAAC6B,mBAAD,EAAsBG,eAAtB,EAAuChC,OAAvC,CAJyB,CAA5B,CAjI2D,CAsI3D;;EACA/D,SAAS,CAAC,YAAY;IAClB,IAAI,CAACI,OAAO,CAACgB,aAAD,EAAgBqE,SAAS,CAAC7B,OAA1B,CAAZ,EAAgD;MAC5C6B,SAAS,CAAC7B,OAAV,GAAoBxC,aAApB;MACA2E,eAAe,CAAC3E,aAAD,CAAf;IACH;EACJ,CALQ,CAAT,CAvI2D,CA6I3D;;EACA,IAAIqF,WAAW,GAAG1G,OAAO,CAAC,YAAY;IAAE,OAAQ5B,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKiD,aAAL,CAAT,EAA8BG,aAAa,CAACgE,WAAD,CAA3C,CAAhB;EAA6E,CAA5F,EAA8F,CAACA,WAAD,EAAcnE,aAAd,EAA6BG,aAA7B,CAA9F,CAAzB;;EACA,IAAImF,EAAE,GAAGpG,UAAU,CAACgC,SAAD,EAAYQ,UAAU,IAAIG,UAA1B,CAAnB;EAAA,IAA0D0D,uBAAuB,GAAGD,EAAE,CAAChD,IAAvF;EAAA,IAA6FkD,MAAM,GAAGF,EAAE,CAACE,MAAzG;EAAA,IAAiHC,cAAc,GAAGH,EAAE,CAACI,OAArI;;EACA,IAAIC,gBAAgB,GAAGJ,uBAAuB,GACxCA,uBAAuB,CAAC7G,MAAxB,CAA+BsD,yBAA/B,CADwC,GAExCA,yBAFN,CAhJ2D,CAmJ3D;;EACA,IAAI4D,qBAAqB,GAAGD,gBAAgB,CAAC1F,MAAjB,CAAwB4F,OAAxB,CAA5B;EACA,IAAIC,oBAAoB,GAAG1E,gBAAgB,GACrCA,gBAAgB,CAACiE,WAAD,CADqB,GAErC,IAFN;;EAGA,IAAIU,EAAE,GAAG3G,cAAc,CAAC8B,SAAD,EAAY2B,UAAZ,EAAwBhC,IAAxB,EAA8BwE,WAA9B,EAA2ClE,MAA3C,EAAmDE,QAAnD,EAA6DJ,OAAO,GACrFlE,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKkE,OAAL,CAAT,EAAwB;IAAE+E,OAAO,EAAEF;EAAX,CAAxB,CAD6E,GAChB;IAAEE,OAAO,EAAEF;EAAX,CADpD,CAAvB;EAAA,IAC+GG,kBAAkB,GAAGF,EAAE,CAACzD,IADvI;EAAA,IAC6I4D,qBAAqB,GAAGH,EAAE,CAACI,GADxK;EAAA,IAC6KC,KAAK,GAAGL,EAAE,CAACK,KADxL;EAAA,IAC+LC,kBAAkB,GAAGN,EAAE,CAACL,OADvN,CAxJ2D,CA0J3D;EACA;;;EACA,IAAIY,uBAAuB,GAAGL,kBAAkB,IAAIA,kBAAkB,CAAC1I,MAAnB,GAA4B,CAAlD,GACxBgJ,eAAe,CAACN,kBAAD,EAAqBL,qBAArB,CADS,GAExBA,qBAAqB,CAACrI,MAAtB,GAA+B,CAA/B,GACIqI,qBADJ,GAEIK,kBAJV;EAKA,IAAIO,UAAU,GAAGjH,aAAa,CAAC;IAC3Bc,KAAK,EAAEA,KADoB;IAE3B4F,kBAAkB,EAAEK,uBAFO;IAG3BX,gBAAgB,EAAEC,qBAHS;IAI3BtE,SAAS,EAAEA;EAJgB,CAAD,CAA9B;EAMA,IAAIoE,OAAO,GAAG5G,WAAW,CAAC,YAAY;IAClC2G,cAAc;IACdY,kBAAkB;EACrB,CAHwB,EAGtB,CAACZ,cAAD,EAAiBY,kBAAjB,CAHsB,CAAzB;EAIA,OAAO;IACHI,QAAQ,EAAE1G,KAAK,CAAC0G,QAAN,IAAkB,MAAMpF,QAD/B;IAEHqF,OAAO,EAAEF,UAAU,CAACE,OAFjB;IAGHC,WAAW,EAAE9F,IAHV;IAIH;IACA;IACAyB,IAAI,EAAE2D,kBAAkB,IAAIA,kBAAkB,CAAC1I,MAAnB,GAA4B,CAAlD,GACAoC,SAAS,CAACsG,kBAAD,CADT,GAEA,EARH;IASH1B,gBAAgB,EAAEA,gBATf;IAUHqC,KAAK,EAAEJ,UAAU,CAACI,KAVf;IAWHlC,YAAY,EAAEA,YAXX;IAYHmC,SAAS,EAAE,KAZR;IAaHjC,UAAU,EAAEA,UAbT;IAcH;IACA;IACAuB,GAAG,EAAED,qBAAqB,IAAIrE,UAhB3B;IAiBH2D,MAAM,EAAEA,MAjBL;IAkBHsB,OAAO,EAAEN,UAAU,CAACO,OAAX,IAAsBjB,oBAlB5B;IAmBH9C,QAAQ,EAAEA,QAnBP;IAoBHU,YAAY,EAAEA,YApBX;IAqBHD,eAAe,EAAEA,eArBd;IAsBHlD,IAAI,EAAEA,IAtBH;IAuBHG,OAAO,EAAEA,OAvBN;IAwBHgF,OAAO,EAAEA,OAxBN;IAyBHrE,QAAQ,EAAEA,QAzBP;IA0BH2F,WAAW,EAAE3G,KAAK,CAACmB,KAAN,IAAeK,UA1BzB;IA2BHuC,SAAS,EAAEA,SA3BR;IA4BHe,UAAU,EAAEA,UA5BT;IA6BHxC,OAAO,EAAEA,OA7BN;IA8BHG,aAAa,EAAEA,aA9BZ;IA+BHF,UAAU,EAAEA,UA/BT;IAgCHmB,OAAO,EAAEA,OAhCN;IAiCHC,cAAc,EAAEA,cAjCb;IAkCHiB,UAAU,EAAEA,UAlCT;IAmCHgC,OAAO,EAAET,UAAU,CAACS,OAnCjB;IAoCHb,KAAK,EAAEA;EApCJ,CAAP;AAsCH,CAjNM;AAkNP,IAAIvE,UAAU,GAAG,EAAjB,C,CACA;;AACA,IAAI0E,eAAe,GAAG,UAAUW,IAAV,EAAgBC,IAAhB,EAAsB;EACxC,IAAIC,GAAG,GAAGlJ,aAAa,CAAC,EAAD,EAAKgJ,IAAL,EAAW,IAAX,CAAvB;;EACA,IAAIf,GAAG,GAAGe,IAAI,CAAChF,GAAL,CAAS,UAAUmF,GAAV,EAAe;IAAE,OAAOA,GAAG,CAAClF,EAAX;EAAgB,CAA1C,CAAV;EACAgF,IAAI,CAAC7D,OAAL,CAAa,UAAU+D,GAAV,EAAe;IACxB,IAAI,CAAClB,GAAG,CAACmB,QAAJ,CAAaD,GAAG,CAAClF,EAAjB,CAAL,EAA2B;MACvBgE,GAAG,CAACoB,IAAJ,CAASF,GAAG,CAAClF,EAAb;MACAiF,GAAG,CAACG,IAAJ,CAASF,GAAT;IACH;EACJ,CALD;EAMA,OAAOD,GAAP;AACH,CAVD;;AAWA,IAAIhH,oBAAoB,GAAG,UAAUoH,UAAV,EAAsB;EAAE,OAAQ;IAAEC,CAAC,EAAED;EAAL,CAAR;AAA6B,CAAhF"},"metadata":{},"sourceType":"module"}